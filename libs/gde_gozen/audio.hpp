#pragma once

#include <godot_cpp/classes/audio_stream_wav.hpp>
#include <godot_cpp/classes/control.hpp>
#include <godot_cpp/classes/image_texture.hpp>
#include <godot_cpp/variant/utility_functions.hpp>
#include <godot_cpp/classes/rendering_server.hpp>
#include <godot_cpp/core/math.hpp>

#include "ffmpeg.hpp"
#include "gozen_error.hpp"


using namespace godot;

class Audio : public Resource {
	GDCLASS(Audio, Resource);

public:
	// pow(10, i / 20)
	// 10^(decibels/20)
	const std::unordered_map<int, double> decibels = {
		{-50, 0.00316227766017}, {-49, 0.00354813389234}, {-48, 0.00398107170553},
		{-47, 0.00446683592151}, {-46, 0.00501187233627}, {-45, 0.00562341325190},
		{-44, 0.00630957344480}, {-43, 0.00707945784384}, {-42, 0.00794328234724},
		{-41, 0.00891250938134}, {-40, 0.01000000000000}, {-39, 0.01122018454302},
		{-38, 0.01258925411794}, {-37, 0.01412537544623}, {-36, 0.01584893192461},
		{-35, 0.01778279410039}, {-34, 0.01995262314969}, {-33, 0.02238721138568},
		{-32, 0.02511886431510}, {-31, 0.02818382931264}, {-30, 0.03162277660168},
		{-29, 0.03548133892336}, {-28, 0.03981071705535}, {-27, 0.04466835921510},
		{-26, 0.05011872336273}, {-25, 0.05623413251903}, {-24, 0.06309573444802},
		{-23, 0.07079457843841}, {-22, 0.07943282347243}, {-21, 0.08912509381337},
		{-20, 0.10000000000000}, {-19, 0.11220184543020}, {-18, 0.12589254117942},
		{-17, 0.14125375446228}, {-16, 0.15848931924611}, {-15, 0.17782794100389},
		{-14, 0.19952623149689}, {-13, 0.22387211385683}, {-12, 0.25118864315096},
		{-11, 0.28183829312645}, {-10, 0.31622776601684}, {-9, 0.354813389233580},
		{-8, 0.39810717055350},  {-7, 0.44668359215096},  {-6, 0.50118723362727},
		{-5, 0.56234132519035},  {-4, 0.63095734448019},  {-3, 0.70794578438414},
		{-2, 0.79432823472428},  {-1, 0.89125093813375},  {0, 1.000000000000000},
		{1, 1.122018454301960},  {2, 1.258925411794170},  {3, 1.412537544622750},
		{4, 1.584893192461110},  {5, 1.778279410038920},  {6, 1.995262314968880},
		{7, 2.238721138568340},  {8, 2.511886431509580},  {9, 2.818382931264450},
		{10, 3.16227766016838},  {11, 3.54813389233576},  {12, 3.98107170553497},
		{13, 4.46683592150963},  {14, 5.01187233627272},  {15, 5.62341325190349},
		{16, 6.30957344480193},  {17, 7.07945784384138},  {18, 7.94328234724282},
		{19, 8.91250938133745},  {20, 10.0000000000000},  {21, 11.2201845430196},
		{22, 12.5892541179417},  {23, 14.1253754462275},  {24, 15.8489319246111},
		{25, 17.7827941003892},  {26, 19.9526231496888},  {27, 22.3872113856834},
		{28, 25.1188643150958},  {29, 28.1838293126445},  {30, 31.6227766016838},
		{31, 35.4813389233575},  {32, 39.8107170553497},  {33, 44.6683592150963},
		{34, 50.1187233627272},  {35, 56.2341325190349},  {36, 63.0957344480193},
		{37, 70.7945784384138},  {38, 79.4328234724281},  {39, 89.1250938133745},
		{40, 100.000000000000},  {41, 112.201845430196},  {42, 125.892541179417},
		{43, 141.253754462275},  {44, 158.489319246111},  {45, 177.827941003892},
		{46, 199.526231496888},  {47, 223.872113856834},  {48, 251.188643150958},
		{49, 281.838293126445},  {50, 316.227766016838}
	};


	static inline int error = 0;


	static inline int get_error() { return error; }

	static inline void enable_debug() { av_log_set_level(AV_LOG_VERBOSE); }
	static AudioStreamWAV *get_wav(String a_path);

	static PackedByteArray combine_data(PackedByteArray a_one, PackedByteArray a_two);


protected:
	static inline void _bind_methods() {
		ClassDB::bind_static_method("Audio", D_METHOD("get_error"), &Audio::get_error);
		ClassDB::bind_static_method("Audio", D_METHOD("get_wav", "a_file_path"), &Audio::get_wav);

		ClassDB::bind_static_method("Audio", D_METHOD("combine_data", "a_one", "a_two"), &Audio::combine_data);
	}
};
